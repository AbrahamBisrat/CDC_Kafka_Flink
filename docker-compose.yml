x-logging: &logging
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"
services:
  postgres:
   image: debezium/example-postgres:1.1
   ports:
    - "5432:5432"
   environment:
    - POSTGRES_DB=postgres
    - POSTGRES_USER=postgres
    - POSTGRES_PASSWORD=postgres
  mysql:
   image: debezium/example-mysql:1.1
   ports:
     - "3306:3306"
   environment:
    - MYSQL_ROOT_PASSWORD=mysql
    - MYSQL_USER=mysql
    - MYSQL_PASSWORD=mysql
  elasticsearch:
   image: elastic/elasticsearch:7.6.0
   environment:
    - cluster.name=docker-cluster
    - bootstrap.memory_lock=true
    - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    - discovery.type=single-node
   ports:
     - "9200:9200"
     - "9300:9300"
   ulimits:
    memlock:
     soft: -1
     hard: -1
    nofile:
     soft: 65536
     hard: 65536
  kibana:
   image: elastic/kibana:8.17.4
   ports:
     - "5601:5601"
   depends_on:
     - elasticsearch
  zookeeper:
   image: zookeeper:latest
   ports:
     - "2181:2181"
  kafka:
   image: bitnami/kafka:latest
   ports:
     - "9092:9092"
     - "9094:9094"
   depends_on:
    - zookeeper
   environment:
    - KAFKA_ADVERTISED_LISTENERS=INSIDE://:9094,OUTSIDE://localhost:9092
    - KAFKA_LISTENERS=INSIDE://:9094,OUTSIDE://:9092
    - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT
    - KAFKA_INTER_BROKER_LISTENER_NAME=INSIDE
    - KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
    - KAFKA_CREATE_TOPICS="user_behaviour:1.1"
   volumes:
     - /var/run/docker.sock:/var/run/docker.sock